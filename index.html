<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Dash-video by joinbox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">

    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="bower_components/dash-video/src/dash-video.html">
    
  </head>
  <body>

    <section class="page-header">
      <h1 class="project-name">Dash-video</h1>
      <h2 class="project-tagline">A web component for playing back responsive dash video</h2>
      <a href="https://github.com/joinbox/dash-video" class="btn">View on GitHub</a>
      <a href="https://github.com/joinbox/dash-video/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/joinbox/dash-video/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="dash-video" class="anchor" href="#dash-video" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dash-video</h1>

<p>
    <style type="text/css">
        .dash-video-player {
            display: block;
        }
        @media screen and (max-width: 370px) {
            .dash-video-player {
                width: 288px;
                height: 162px;
            }
        }
        @media screen and (max-width: 672px) and (min-width: 371px) {
            .dash-video-player {
                width: 352px;
                height: 198px;
            }
        }
        @media screen and (max-width: 999px) and (min-width: 673px) {
            .dash-video-player {
                width: 640px;
                height: 360px;
            }
        }
        @media screen and (max-width: 1300px) and (min-width: 1000px) {
            .dash-video-player {
                width: 896px;
                height: 504px;
            }
        }
        @media screen and (min-width: 1301px) {
            .dash-video-player {
                width: 960px;
                height: 540px;
            }
        }
        
    </style>

    <dash-video autoplay loop class="dash-video-player">
        <source type="application/dash+xml"       media="screen and (min-width:1000px)"                           src="video/sample_manifest.mpd" />
        <source type="video/mp4"                  media="screen and (max-width:1024px)"                           src="video/sample_video_360p_500k.mp4" />
        <source type="video/mp4"                  media="screen and (min-width:1025px) and (max-width:1919px)"    src="video/sample_video_720p_500k.mp4" />
        <source type="video/mp4"                  media="screen and (min-width:1920px)"                           src="video/sample_video_1080p_3000k.mp4" />
        <source type="video/mp4"                  media="screen and (max-width:1024px)"                           src="video/sample_crapple_360p.mp4" data-autoplay />
        <source type="video/mp4"                  media="screen and (min-width:1025px)"                           src="video/sample_crapple_720p.mp4" data-autoplay />
    </dash-video>
</p>

<p>A web component for playing back videos</p>

<ul>
<li>auto play on all platforms</li>
<li>non fullscreen videos on the iphone</li>
<li>dash, adaptive video support (webm, vp9, ogg vorbis)</li>
<li>html5 video support (any format supported by the browser)</li>
<li>support for media queries on the video sources</li>
</ul>

<p>Known issues:</p>

<ul>
<li>no controls</li>
<li>iOS (non fullscreen / autoplay): no audio, only short videos, up to 720p video</li>
<li>the pain in the ass of encoding videos</li>
<li>dash is slow on android devices (you can disable playback using media queries)</li>
</ul>

<p>Made possible by </p>

<ul>
<li><a href="https://github.com/mbebenita/Broadway">Broadway</a></li>
<li><a href="https://github.com/google/shaka-player">Shaka Player</a></li>
</ul>

<p>Thanks for the great work!</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>Have a look at <a href="https://opensource.org/licenses">https://opensource.org/licenses</a> for details</p>

<ul>
<li>Code Commited by joinbox staff: MIT</li>
<li>For the iOS part (h.264 decoder), please have a look at the licence agreements of the mpeg-la,
it's probably free for personal and non-commercial use. Use on your own risk!</li>
<li>Broadway: 3-clause BSD &amp; Apache 2.0 license</li>
<li>Shaka Player: Apache License 2.0</li>
<li>Sample movies: Big Buck Bunny (c) copyright 2008, Blender Foundation / <a href="www.bigbuckbunny.org">www.bigbuckbunny.org</a>
</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>installation</h2>

<pre><code>bower i dash-video
</code></pre>

<h2>
<a id="using-the-component" class="anchor" href="#using-the-component" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using the component</h2>

<p>You need to include the following lines in the head section of your html file</p>

<pre><code>&lt;script src="bower_components/webcomponentsjs/webcomponents.min.js"&gt;&lt;/script&gt;
&lt;link rel="import"  href="bower_components/src/dash-video.html"&gt;
</code></pre>

<p>Setting up your first video using the dash-video tag</p>

<pre><code>&lt;dash-video autoplay loop style="width:1280px; height:720px;" id="dash-video-player"&gt;
    &lt;!-- dash video --&gt;
    &lt;source type="application/dash+xml"     media="screen and (min-width:1005px)"   src="http://whaever.127.0.0.1.xip.io:80/long_manifest.mpd" /&gt;

    &lt;!-- normal html5 video --&gt;
    &lt;source type="video/mp4"                media="screen and (min-width:1025px)"   src="video/input_1080p.mp4" /&gt;

    &lt;!-- special video for ios, note the data-crapple attribute --&gt;
    &lt;source type="video/mp4"                media="screen and (min-width:125px)"    src="video/crapple_hi.mp4" data-crapple/&gt;
&lt;/dash-video&gt;
</code></pre>

<p>That's it!</p>

<p>If you have trouble loading video files from localhost while developing you may start the node server that set the correct cors headers:</p>

<pre><code>npm i
node server.js
</code></pre>

<p>The server listens on port 8000, you can now navigate to (localhost:8000)[<a href="http://whatever.127.0.0.1.xip.io:8000/">http://whatever.127.0.0.1.xip.io:8000/</a>]</p>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h2>

<p>The api currently supports only two methods. Create an issue if you need more functionality!</p>

<h3>
<a id="play-method" class="anchor" href="#play-method" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>play() method</h3>

<p>plays / resumes playback</p>

<pre><code>document.querySelector('#dash-video-player').play();
</code></pre>

<h3>
<a id="pause-method" class="anchor" href="#pause-method" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pause() method</h3>

<p>pauses playback</p>

<pre><code>document.querySelector('#dash-video-player').pause();
</code></pre>

<h2>
<a id="encoding-videos" class="anchor" href="#encoding-videos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Encoding Videos</h2>

<p>Those are instructions for ubuntu 15.10. It's a pain in the ass!</p>

<h3>
<a id="compiling-ffmpeg-and-dependecies" class="anchor" href="#compiling-ffmpeg-and-dependecies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compiling ffmpeg and dependecies</h3>

<p>You have to compile an up to date version of ffmpeg in order to create dash and apple compatible video files.</p>

<p>first install required tools</p>

<pre><code>sudo apt-get install cmake make g++ git-core gcc yasm
</code></pre>

<p>then install dependencies</p>

<pre><code>sudo apt-get install libx264-dev
</code></pre>

<p>get the required source files from <a href="https://www.xiph.org/downloads/">https://www.xiph.org/downloads/</a> and compile them</p>

<p>ogg</p>

<pre><code>wget http://downloads.xiph.org/releases/ogg/libogg-1.3.2.tar.gz
tar xzvf libogg-1.3.2.tar.gz
cd libogg-1.3.2
./configure
make
sudo make install
</code></pre>

<p>vorbis</p>

<pre><code>wget http://downloads.xiph.org/releases/vorbis/libvorbis-1.3.5.tar.gz
tar xzvf libvorbis-1.3.5.tar.gz
cd libvorbis-1.3.5
./configure
make
sudo make install
</code></pre>

<p>libvpx</p>

<pre><code>git clone https://chromium.googlesource.com/webm/libvpx
cd libvpx
./configure
make
sudo make install
</code></pre>

<p>ffmpeg</p>

<pre><code>git clone git://source.ffmpeg.org/ffmpeg.git
cd ffmpeg
# maybe: cmake
./configure --enable-libvpx --enable-libvorbis --enable-gpl --enable-libx264
make
sudo make install
</code></pre>

<p>If i forgot something please file an issue!</p>

<h3>
<a id="mp4-video" class="anchor" href="#mp4-video" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MP4 video</h3>

<pre><code>ffmpeg -i input_720.webm -c:v libx264 -s 1280x720 -b:v 1500k -f mp4 -metadata title="My Cool Video" encoder="ffmpeg" -c:a copy -movflags +faststart video_720p_500k.mp4
</code></pre>

<h3>
<a id="video-for-crapple-devices" class="anchor" href="#video-for-crapple-devices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Video for Crapple devices</h3>

<pre><code>ffmpeg -y -i input3_720p.mp4 -r 30000/1001 -b:a 2M -bt 4M -vcodec libx264 -pass 1 -coder 0 -bf 0 -flags -loop -wpredp 0 -an crapple_hi.mp4
</code></pre>

<h3>
<a id="dash-video-1" class="anchor" href="#dash-video-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dash Video</h3>

<p>See <a href="http://wiki.webmproject.org/adaptive-streaming/instructions-to-playback-adaptive-webm-using-dash">DASH &amp; VP9</a> for a short explanation!</p>

<pre><code>VIDEO_TITLE="My Cool Video"


# DASH VP9
VP9_DASH_PARAMS="-tile-columns 4 -frame-parallel 1"


# create videos in different qualities
ffmpeg -i input.mp4 -c:v libvpx-vp9 -s 160x90 -threads 4 -b:v 250k -keyint_min 150 -g 60 ${VP9_DASH_PARAMS} -an -metadata title=${VIDEO_TITLE} -metadata encoder="ffmpeg" -r 30 -f webm -dash 1 long_video_90p_250k.webm
ffmpeg -i input.mp4 -c:v libvpx-vp9 -s 320x180 -threads 4 -b:v 500k -keyint_min 150 -g 60 ${VP9_DASH_PARAMS} -an -metadata title=${VIDEO_TITLE} -metadata encoder="ffmpeg" -r 30 -f webm -dash 1 long_video_180p_500k.webm
ffmpeg -i input.mp4 -c:v libvpx-vp9 -s 640x360 -threads 4 -b:v 750k -keyint_min 150 -g 60 ${VP9_DASH_PARAMS} -an -metadata title=${VIDEO_TITLE} -metadata encoder="ffmpeg" -r 30 -f webm -dash 1 long_video_360p_750k.webm
ffmpeg -i input.mp4 -c:v libvpx-vp9 -s 640x360 -threads 4 -b:v 1000k -keyint_min 150 -g 60 ${VP9_DASH_PARAMS} -an -metadata title=${VIDEO_TITLE} -metadata encoder="ffmpeg" -r 30 -f webm -dash 1 long_video_360p_1000k.webm
ffmpeg -i input.mp4 -c:v libvpx-vp9 -s 1280x720 -threads 4 -b:v 1500k -keyint_min 150 -g 60 ${VP9_DASH_PARAMS} -an -metadata title=${VIDEO_TITLE} -metadata encoder="ffmpeg" -r 30 -f webm -dash 1 long_video_720p_500k.webm

# audio track
ffmpeg -i input.mp4 -c:a libvorbis -b:a 128k -vn -r 30 -f webm -dash 1 long_audio_128k.webm


# set cue points
./bin/sample_muxer -i long_video_90p_250k.webm -o long_video_90p_250k_cued.webm
./bin/sample_muxer -i long_video_180p_500k.webm -o long_video_180p_500k_cued.webm
./bin/sample_muxer -i long_video_360p_750k.webm -o long_video_360p_750k_cued.webm
./bin/sample_muxer -i long_video_360p_1000k.webm -o long_video_360p_1000k_cued.webm
./bin/sample_muxer -i long_video_720p_500k.webm -o long_video_720p_500k_cued.webm

# for the audio too
ffmpeg -i long_audio_128k.webm -vn -acodec libvorbis -ab 128k -dash 1 long_audio_128k_cued.webm


# create dash manifest
ffmpeg \
 -analyzeduration 2147483647 -probesize 2147483647 \
 -f webm_dash_manifest -i long_video_90p_250k_cued.webm \
 -f webm_dash_manifest -i long_video_180p_500k_cued.webm \
 -f webm_dash_manifest -i long_video_360p_750k_cued.webm \
 -f webm_dash_manifest -i long_video_360p_1000k_cued.webm \
 -f webm_dash_manifest -i long_video_720p_500k_cued.webm \
 -f webm_dash_manifest -i long_audio_128k_cued.webm \
 -c copy -map 0 -map 1 -map 2 -map 3 -map 4 -map 5 \
 -f webm_dash_manifest \
 -adaptation_sets "id=0,streams=0,1,2,3,4 id=1,streams=5" \
 long_manifest.mpd
</code></pre>

<h2>
<a id="links" class="anchor" href="#links" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Links</h2>

<ul>
<li><a href="http://wiki.webmproject.org/adaptive-streaming/instructions-to-playback-adaptive-webm-using-dash">DASH &amp; VP9</a></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/joinbox/dash-video">Dash-video</a> is maintained by <a href="https://github.com/joinbox">joinbox</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
